<!doctype html>
<html>
<head><meta charset="utf-8"/><title>Manage Sessions</title>
<style>body{font-family:Arial;padding:18px} .session{padding:8px;border:1px solid #ddd;margin:8px 0;border-radius:6px;display:flex;justify-content:space-between;align-items:center} .btn{padding:6px 10px;border-radius:6px;border:1px solid #bbb;background:#fff;cursor:pointer}</style>
</head>
<body>
  <h3>Saved Sessions</h3>
  <div id="list"></div>
  <script>
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxEpMGjGgkn8a7_RG0-fSyPj-IZny88ZChcqtQ_ks1ALOv0bxrKYTmLy8pSjx0A5euX5A/exec';
  async function load() {
    const res = await fetch(WEB_APP_URL + '?mode=sessions');
    const json = await res.json();
    const list = document.getElementById('list');
    list.innerHTML = '';
    (json.sessions||[]).forEach(s=>{
      const div = document.createElement('div'); div.className='session';
      const left = document.createElement('div'); left.textContent = `${s.label} â€” ${s.timestamp} (${s.kcalTotal||0} kcal)`;
      const right = document.createElement('div');
      const btnView = document.createElement('button'); btnView.className='btn'; btnView.textContent='View';
      btnView.onclick = ()=> { window.open('compare.html?sessionId=' + encodeURIComponent(s.sessionId),'_blank'); };
      const btnDel = document.createElement('button'); btnDel.className='btn'; btnDel.textContent='Delete';
      btnDel.onclick = async ()=> {
        if (!confirm('Delete session?')) return;
        const form = new URLSearchParams();
        form.append('mode','deleteSession'); form.append('sessionId', s.sessionId);
        const r = await fetch(WEB_APP_URL, { method:'POST', body: form });
        const j = await r.json();
        if (j && j.status === 'ok') { load(); } else { alert('Delete failed'); }
      };
      right.appendChild(btnView); right.appendChild(btnDel);
      div.appendChild(left); div.appendChild(right);
      list.appendChild(div);
    });
  }
  load();
  </script>
</body>
</html>
